<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>truyentranhgay 18+</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:white;
    color:black;
    transition:0.3s;
}
.dark{
    background:#111;
    color:white;
}
header{
    background:#e91e63;
    color:white;
    padding:15px;
    display:flex;
    justify-content:space-between;
}
button{
    padding:6px 12px;
    cursor:pointer;
}
.container{
    padding:20px;
}
.card{
    border:1px solid #ccc;
    padding:15px;
    margin-bottom:15px;
}
.hidden{
    display:none;
}
select,input,textarea{
    width:100%;
    margin-bottom:10px;
    padding:8px;
}
.comment-box{
    margin-top:10px;
    border-top:1px solid gray;
    padding-top:10px;
}
</style>
</head>
<body>

<header>
    <h2>truyentranhgay 18+</h2>
    <div>
        <button onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>
        <button onclick="showLogin()">ƒêƒÉng nh·∫≠p</button>
        <button onclick="showUpload()">ƒêƒÉng t√°c ph·∫©m</button>
    </div>
</header>

<div class="container">

<h3>üìö Ph√¢n lo·∫°i</h3>
<select id="filterType" onchange="loadPosts()">
    <option value="all">T·∫•t c·∫£</option>
    <option value="text">Truy·ªán ch·ªØ</option>
    <option value="comic">Truy·ªán tranh</option>
    <option value="image">·∫¢nh t·ª± do</option>
</select>

<div id="posts"></div>

</div>

<!-- LOGIN -->
<div id="loginBox" class="container hidden">
<h3>ƒêƒÉng nh·∫≠p</h3>
<input id="nickname" placeholder="Bi·ªát danh">
<button onclick="login()">X√°c nh·∫≠n</button>
</div>

<!-- UPLOAD -->
<div id="uploadBox" class="container hidden">
<h3>ƒêƒÉng t√°c ph·∫©m</h3>

<select id="type">
    <option value="text">Truy·ªán ch·ªØ</option>
    <option value="comic">Truy·ªán tranh</option>
    <option value="image">·∫¢nh t·ª± do</option>
</select>

<input id="title" placeholder="Ti√™u ƒë·ªÅ">
<input id="country" placeholder="Qu·ªëc gia">
<input id="language" placeholder="Ng√¥n ng·ªØ g·ªëc">
<input id="genre" placeholder="Th·ªÉ lo·∫°i">
<select id="translated">
    <option value="C√≥ d·ªãch">C√≥ d·ªãch</option>
    <option value="Ch∆∞a d·ªãch">Ch∆∞a d·ªãch</option>
</select>

<textarea id="content" placeholder="N·ªôi dung ho·∫∑c link ·∫£nh"></textarea>

<button onclick="upload()">ƒêƒÉng</button>
</div>

<script>

let currentUser = localStorage.getItem("user");

function toggleTheme(){
    document.body.classList.toggle("dark");
}

function showLogin(){
    document.getElementById("loginBox").classList.toggle("hidden");
}

function showUpload(){
    if(!currentUser){
        alert("B·∫°n ph·∫£i ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒëƒÉng t√°c ph·∫©m!");
        return;
    }
    document.getElementById("uploadBox").classList.toggle("hidden");
}

function login(){
    let name = document.getElementById("nickname").value;
    if(name){
        localStorage.setItem("user", name);
        currentUser = name;
        alert("ƒêƒÉng nh·∫≠p th√†nh c√¥ng v·ªõi bi·ªát danh: " + name);
    }
}

function upload(){
    let post = {
        type:document.getElementById("type").value,
        title:document.getElementById("title").value,
        country:document.getElementById("country").value,
        language:document.getElementById("language").value,
        genre:document.getElementById("genre").value,
        translated:document.getElementById("translated").value,
        content:document.getElementById("content").value,
        author:currentUser,
        comments:[]
    };

    let posts = JSON.parse(localStorage.getItem("posts") || "[]");
    posts.push(post);
    localStorage.setItem("posts", JSON.stringify(posts));
    alert("ƒêƒÉng th√†nh c√¥ng!");
    loadPosts();
}

function loadPosts(){
    let filter = document.getElementById("filterType").value;
    let posts = JSON.parse(localStorage.getItem("posts") || "[]");
    let container = document.getElementById("posts");
    container.innerHTML = "";

    posts.forEach((p,index)=>{
        if(filter !== "all" && p.type !== filter) return;

        let div = document.createElement("div");
        div.className="card";
        div.innerHTML=`
            <h3>${p.title}</h3>
            <p><b>T√°c gi·∫£:</b> ${p.author}</p>
            <p><b>Lo·∫°i:</b> ${p.type}</p>
            <p><b>Th·ªÉ lo·∫°i:</b> ${p.genre}</p>
            <p><b>Qu·ªëc gia:</b> ${p.country}</p>
            <p><b>Ng√¥n ng·ªØ:</b> ${p.language}</p>
            <p><b>T√¨nh tr·∫°ng d·ªãch:</b> ${p.translated}</p>
            <hr>
            <p>${p.content}</p>
            <div class="comment-box">
                <h4>B√¨nh lu·∫≠n</h4>
                ${renderComments(p,index)}
            </div>
        `;
        container.appendChild(div);
    });
}

function renderComments(post,index){
    let html="";
    post.comments.forEach(c=>{
        html += `<p><b>${c.user}:</b> ${c.text} 
        <button onclick="translateComment('${c.text}')">D·ªãch</button></p>`;
    });

    if(currentUser){
        html += `
        <input id="comment${index}" placeholder="Vi·∫øt b√¨nh lu·∫≠n">
        <button onclick="addComment(${index})">G·ª≠i</button>
        `;
    } else {
        html += "<p>ƒêƒÉng nh·∫≠p ƒë·ªÉ b√¨nh lu·∫≠n</p>";
    }

    return html;
}

function addComment(index){
    let posts = JSON.parse(localStorage.getItem("posts"));
    let text = document.getElementById("comment"+index).value;
    posts[index].comments.push({user:currentUser,text:text});
    localStorage.setItem("posts", JSON.stringify(posts));
    loadPosts();
}

function translateComment(text){
    alert("Gi·∫£ l·∫≠p d·ªãch: " + text);
}

loadPosts();

</script>

</body>
</html>
<script>

let currentUser = localStorage.getItem("user");

function toggleTheme(){
    document.body.classList.toggle("dark");
}

function showLogin(){
    document.getElementById("loginBox").classList.toggle("hidden");
}

function showUpload(){
    if(!currentUser){
        alert("B·∫°n ph·∫£i ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒëƒÉng t√°c ph·∫©m!");
        return;
    }
    document.getElementById("uploadBox").classList.toggle("hidden");
}

function login(){
    let name = document.getElementById("nickname").value;
    if(name){
        localStorage.setItem("user", name);
        currentUser = name;
        alert("ƒêƒÉng nh·∫≠p th√†nh c√¥ng v·ªõi bi·ªát danh: " + name);
    }
}

function upload(){
    let post = {
        id: Date.now(),
        type:document.getElementById("type").value,
        title:document.getElementById("title").value,
        country:document.getElementById("country").value,
        language:document.getElementById("language").value,
        genre:document.getElementById("genre").value,
        translated:document.getElementById("translated").value,
        content:document.getElementById("content").value,
        author:currentUser,
        comments:[],
        votes:[],
        voteHistory:[]
    };

    let posts = JSON.parse(localStorage.getItem("posts") || "[]");
    posts.push(post);
    localStorage.setItem("posts", JSON.stringify(posts));
    alert("ƒêƒÉng th√†nh c√¥ng!");
    loadPosts();
}

function votePost(index){
    if(!currentUser){
        alert("B·∫°n ph·∫£i ƒëƒÉng nh·∫≠p ƒë·ªÉ b√¨nh ch·ªçn!");
        return;
    }

    let posts = JSON.parse(localStorage.getItem("posts"));
    let post = posts[index];

    if(post.voteHistory.includes(currentUser)){
        alert("B·∫°n ƒë√£ vote r·ªìi!");
        return;
    }

    post.votes.push({
        user:currentUser,
        time:new Date().toISOString()
    });

    post.voteHistory.push(currentUser);

    localStorage.setItem("posts", JSON.stringify(posts));
    loadPosts();
}

function loadPosts(){
    let filter = document.getElementById("filterType").value;
    let posts = JSON.parse(localStorage.getItem("posts") || "[]");
    let container = document.getElementById("posts");
    container.innerHTML = "";

    renderTop(posts);

    posts.forEach((p,index)=>{
        if(filter !== "all" && p.type !== filter) return;

        let div = document.createElement("div");
        div.className="card";
        div.innerHTML=`
            <h3>${p.title}</h3>
            <p><b>T√°c gi·∫£:</b> ${p.author}</p>
            <p><b>Lo·∫°i:</b> ${p.type}</p>
            <p><b>Th·ªÉ lo·∫°i:</b> ${p.genre}</p>
            <p><b>Qu·ªëc gia:</b> ${p.country}</p>
            <p><b>Ng√¥n ng·ªØ:</b> ${p.language}</p>
            <p><b>T√¨nh tr·∫°ng d·ªãch:</b> ${p.translated}</p>
            <p>‚≠ê Vote: ${p.votes.length}</p>
            <button onclick="votePost(${index})">B√¨nh ch·ªçn</button>
            <hr>
            <p>${p.content}</p>
            <div class="comment-box">
                <h4>B√¨nh lu·∫≠n</h4>
                ${renderComments(p,index)}
            </div>
        `;
        container.appendChild(div);
    });
}

function renderTop(posts){

    let today = new Date();
    let day = today.toISOString().split("T")[0];
    let month = today.getMonth();
    let year = today.getFullYear();

    function countVotes(post, type){
        return post.votes.filter(v=>{
            let d = new Date(v.time);
            if(type==="day") return v.time.startsWith(day);
            if(type==="month") return d.getMonth()===month && d.getFullYear()===year;
            if(type==="year") return d.getFullYear()===year;
        }).length;
    }

    let topDay = [...posts].sort((a,b)=>countVotes(b,"day")-countVotes(a,"day"))[0];
    let topMonth = [...posts].sort((a,b)=>countVotes(b,"month")-countVotes(a,"month"))[0];
    let topYear = [...posts].sort((a,b)=>countVotes(b,"year")-countVotes(a,"year"))[0];

    let container = document.getElementById("posts");

    let topHTML = `
    <div class="card">
        <h2>üèÜ B·∫£ng x·∫øp h·∫°ng</h2>
        <p>ü•á Top ng√†y: ${topDay ? topDay.title : "Ch∆∞a c√≥"}</p>
        <p>ü•á Top th√°ng: ${topMonth ? topMonth.title : "Ch∆∞a c√≥"}</p>
        <p>ü•á Top nƒÉm: ${topYear ? topYear.title : "Ch∆∞a c√≥"}</p>
    </div>
    `;

    container.innerHTML = topHTML;
}

function renderComments(post,index){
    let html="";
    post.comments.forEach(c=>{
        html += `<p><b>${c.user}:</b> ${c.text}</p>`;
    });

    if(currentUser){
        html += `
        <input id="comment${index}" placeholder="Vi·∫øt b√¨nh lu·∫≠n">
        <button onclick="addComment(${index})">G·ª≠i</button>
        `;
    } else {
        html += "<p>ƒêƒÉng nh·∫≠p ƒë·ªÉ b√¨nh lu·∫≠n</p>";
    }

    return html;
}

function addComment(index){
    let posts = JSON.parse(localStorage.getItem("posts"));
    let text = document.getElementById("comment"+index).value;
    posts[index].comments.push({user:currentUser,text:text});
    localStorage.setItem("posts", JSON.stringify(posts));
    loadPosts();
}

loadPosts();

</script>
